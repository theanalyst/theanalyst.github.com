<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tagged with "Hy" - Often Bearing Metaphoric Tense</title>
    <meta name="description" content="">
    <meta name="author" content="Abhishek L">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://theanalyst.github.io/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="https://fonts.googleapis.com/css?family=Gudea:400,400italic|Alegreya+SC" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap.no-icons.min.css" rel="stylesheet">
    <link href="http://theanalyst.github.io/theme/local.css" rel="stylesheet">
    <link href="http://theanalyst.github.io/theme/pygments.css" rel="stylesheet">
    <link href="http://theanalyst.github.io/theme/font-awesome.css" rel="stylesheet">
</head>

<body>
<header class="blog-header">
  <div class="container">
    <div class="row-fluid">
      <div class="span9">
	<a href="http://theanalyst.github.io" class="brand">Often Bearing Metaphoric Tense</a>
      </div>

      <div class="span3" id="blog-nav">
	<ul class="nav nav-pills pull-right">
            <li><a href="http://theanalyst.github.io/pages/about.html">About</a></li>
	    <li >
	      <a href="http://theanalyst.github.io/category/tech.html ">Tech</a>
	    <li >
	      <a href="http://theanalyst.github.io/category/rants.html ">Rants</a>
	</ul>
      </div>
    </div> <!-- End of fluid row-->
  </div>   <!-- End of Container-->
</header>
    
<div class="container">
    <div class="content">
    <div class="row-fluid">

        <div class="span10">
        

        

    <div class='row-fluid''>
        <div class="article-title span9">
            <a href="http://theanalyst.github.io/2014-the-year-in-books-using-goodreads-pandas-hy.html"><h1>2014: the year in books, using Goodreads, pandas & Hy</h1></a>
        </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
<p>21 Dec 2014 </p>

<p style="text-align: left;">
Filed under <a href="http://theanalyst.github.io/category/tech.html">Tech</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="http://theanalyst.github.io/tag/hy.html">Hy</a> <a href="http://theanalyst.github.io/tag/goodreads.html">Goodreads</a> <a href="http://theanalyst.github.io/tag/pandas.html">Pandas</a> <a href="http://theanalyst.github.io/tag/kindle.html">Kindle</a> </p>
<p>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="abhishekl">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
</p>
      </div>
      <div class="article-content span8">
	<p>As 2014 is coming to a close, I thought it would be a nice time to
review the year as far as reading was concerned. Since I track the
books I read using Goodreads, I felt it would be an interesting
experiment to see some numbers from Goodreads. Though Goodreads
provides an api, it doesn't seem to be directly useful to get some
numbers from a user account (I could be wrong here). Fortunately, an
export to csv option is provieded in the account which helps in our
favor.</p>
<p>For any kind of data analysis in python, <a href="http://pandas.pydata.org">pandas</a> is a brilliant
library. Also it does most of the heavy lifting as far as processing
csv files are concerned. Since <a href="http://hylang.org">Hy</a> works wherever python works, I
thought it would be an interesting experiment to use Hy to parse the
data.</p>
<p>To start with reading csv is a simple call to pandas' <code>read_csv</code>
function.</p>
<div class="highlight"><pre><span class="p">(</span><span class="k">import </span><span class="nv">pandas</span>
    <span class="p">[</span><span class="nv">numpy</span> <span class="ss">:as</span> <span class="nv">np</span><span class="p">]</span>
    <span class="p">[</span><span class="nv">matplotlib.pyplot</span> <span class="ss">:as</span> <span class="nv">plt</span><span class="p">]</span>
    <span class="p">[</span><span class="nv">seaborn</span> <span class="ss">:as</span> <span class="nv">sns</span><span class="p">])</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">parse-csv</span> <span class="p">[</span><span class="nv">filepath</span> <span class="nv">kwargs</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">apply</span> <span class="nv">pandas.read_csv</span> <span class="p">[</span><span class="nv">filepath</span><span class="p">]</span> <span class="nv">kwargs</span><span class="p">))</span>
</pre></div>


<p>Now taking out only the column's we're interested in &amp; filtering out
the data from only a particular year can be done by</p>
<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">books-in-year</span> <span class="p">[</span><span class="nv">dataframe</span> <span class="nv">year</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[[</span><span class="nv">day1</span> <span class="p">(</span><span class="kd">fn </span><span class="p">[</span><span class="nv">y</span><span class="p">]</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nb">str</span> <span class="nv">y</span><span class="p">)</span> <span class="s">&quot;-01-01&quot;</span><span class="p">))]]</span>
    <span class="p">(</span><span class="nb">slice</span> <span class="p">(</span><span class="nf">.</span> <span class="nv">dataframe</span> <span class="nv">ix</span><span class="p">)</span> <span class="p">(</span><span class="nf">day1</span> <span class="nv">year</span><span class="p">)</span> <span class="p">(</span><span class="nf">day1</span> <span class="p">(</span><span class="nb">inc </span><span class="nv">year</span><span class="p">)))))</span>
</pre></div>


<p><code>ix</code> returns the index of dataframe, since we'll be indexing by date
read, this allows us to select the required range, by simply selecting
a date range from the beginning of the year to the next year.</p>
<p>Since it would be interesting to see the count of books as well as the
pages on a monthly basis, we should filter the data on a monthly
basis. Pandas offers a <a href="http://pandas.pydata.org/pandas-docs/stable/groupby.html"><code>groupby</code></a> &amp; <code>aggregate</code> much similiar to
SQL like queries. So all we have to do is to group pages by month
here.</p>
<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">aggregate-by-month</span> <span class="p">[</span><span class="nv">dataframe</span> <span class="nv">params</span><span class="p">]</span>
  <span class="s">&quot;Group a particular key by month&quot;</span>
  <span class="p">(</span><span class="k">-&gt; </span><span class="p">(</span><span class="nf">.groupby</span> <span class="nv">dataframe</span> <span class="p">(</span><span class="nf">.</span> <span class="nv">dataframe</span> <span class="nv">index</span> <span class="nv">month</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">.aggregate</span> <span class="nv">params</span><span class="p">)))</span>
</pre></div>


<p>The above function assumes that the dataframe object is already
indexed by a timeframe data, (Date Read in our case), then a simple
groupby month is performed and supplied to <code>aggregate</code> which does a
cumulative operation on the grouped data according the supplied
functions. The threading operator <code>-&gt;</code> makes the result of the first
call as the first argument of the function. Now we have enough to get
some stats for the year.</p>
<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">process</span> <span class="p">[</span><span class="nv">filepath</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[[</span><span class="nv">required-fields</span> <span class="p">[</span><span class="s">&quot;Title&quot;</span> <span class="s">&quot;Date Read&quot;</span> <span class="s">&quot;Bookshelves&quot;</span>
              <span class="s">&quot;Number of Pages&quot;</span> <span class="s">&quot;Original Publication Year&quot;</span><span class="p">]]</span>
        <span class="p">[</span><span class="nv">books-in-2014</span>
          <span class="p">(</span><span class="k">-&gt; </span><span class="p">(</span><span class="nf">parse-csv</span> <span class="nv">filepath</span>
                         <span class="p">{</span><span class="s">&quot;usecols&quot;</span> <span class="nv">required-fields</span>
                          <span class="s">&quot;parse_dates&quot;</span> <span class="p">[</span><span class="s">&quot;Date Read&quot;</span><span class="p">]</span>
                           <span class="s">&quot;index_col&quot;</span> <span class="s">&quot;Date Read&quot;</span><span class="p">})</span>
               <span class="p">(</span><span class="nf">books-in-year</span> <span class="mi">2014</span><span class="p">))]</span>
        <span class="p">[</span><span class="nv">pages-per-month</span> <span class="p">(</span><span class="k">-&gt; </span><span class="p">(</span><span class="nf">.</span> <span class="nv">books-in-2014</span> <span class="p">[[</span><span class="s">&quot;Number of Pages&quot;</span><span class="p">]])</span>
                         <span class="p">(</span><span class="nf">aggregate-by-month</span> <span class="p">[</span><span class="s">&quot;sum&quot;</span> <span class="s">&quot;count&quot;</span> <span class="nv">np.mean</span><span class="p">]))]]</span>
  <span class="p">(</span><span class="k">print</span> <span class="s">&quot;Pages read in 2014 &quot;</span>
         <span class="p">((</span><span class="nf">.</span> <span class="nv">books-in-2014</span> <span class="p">[</span><span class="s">&quot;Number of Pages&quot;</span><span class="p">]</span> <span class="nb">sum</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">print</span> <span class="s">&quot;Pages read in kindle&quot;</span>
         <span class="p">((</span><span class="nf">.</span> <span class="nv">books-in-2014</span> <span class="p">[(</span><span class="nf">=</span> <span class="nv">books-in-2014.Bookshelves</span> <span class="s">&quot;kindle&quot;</span><span class="p">)]</span>
             <span class="p">[</span><span class="s">&quot;Number of Pages&quot;</span><span class="p">]</span> <span class="nb">sum</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">print</span> <span class="s">&quot;Monthly Stats&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="k">print</span> <span class="nv">pages-per-month</span><span class="p">)</span>
</pre></div>


<p>First, the <code>parse-csv</code> function is given only the interesting columns,
also indexing is done via date read, we get <code>pages-per-month</code> via the
aggregate &amp; groupby function shown earlier. Counting the pages read in
Kindle was done by summing columns containing the Book shelves
(alternatively if you had marked the editions correctly another field
suggest the Kindle edition..).</p>
<div class="highlight"><pre>Pages read in 2014  6659.0
Pages read in kindle 4489.0
Monthly Stats
Number of Pages                   
            sum  count        mean
 1              1061      3  353.666667
 2               136      2   68.000000
 6               373      1  373.000000
 8               484      2  242.000000
 9              1445      8  180.625000
 10             2126     17  125.058824
 11              262      1  262.000000
 12              772      6  128.666667
</pre></div>


<p>Finally this is the plot of pages</p>
<p><img alt="pages_per_month" src="images/pages-per-month.png" /></p>
<p>Overall 2014 was a good year as far as reading was concerned, read a
lot of classics which had been on my backlog for quite sometime. Also
read <em>The Guide</em>, which was pending for quite some time. Next year I
should follow a more consistent schedule :), there were months with no
reading at all and a few with too much (the peak in october was
probably due to the combined holidays here, at that time) The raw data
and output (as well as the program) are available in my <a href="http://github.com/theanalyst/cuddlebear">github</a>
repo.</p> 
	<a class="btn btn-mini xsmall" href="http://theanalyst.github.io/2014-the-year-in-books-using-goodreads-pandas-hy.html">
          <i class="icon-comment"></i> Comment </a>
	<hr />
      </div>
      
    </div>
    
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://theanalyst.github.io/tag/hy.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>
 
  
        </div>
        
        
    </div>     </div> </div>

<!--footer-->
<div class="container">
  <div class="well" style="background-color: #E9EFF6">
    <div id="blog-footer">
      <div class="row-fluid">
	<div class="social span2" align="center" id="socialist">
	  <ul class="nav nav-list">
	    <li class="nav-header">
	      Social
	    </li>
	    <li><a href="http://twitter.com/abhishekl"><i class="icon-twitter" style="color: #1f334b"></i>twitter</a></li>
	    <li><a href="http://github.com/theanalyst"><i class="icon-github" style="color: #1f334b"></i>github</a></li>
	    <li><a href="http://theanalystquotes.blogspot.com"><i class="icon-blogger" style="color: #1f334b"></i>blogger</a></li>
            <a href="mailto:abhishekl.2006@gmail.com"><i class="icon-envelope" style="color: #1f334b" ></i> email</a>

	  </ul>
	</div>
<div class="span8" id="colophon">
  <h2 align="center">Colophon</h2>
  <p align="justify"> 
 Hello there, thanks for the interest to scroll all the way down
 This is a blog for random things that I find
 interesting. There are two broad categories here, possibly non
 intersecting sections of posts here. Also, Often Bearing Metaphoric
 Tense anagrams to the "Importance of Being Earnest", Algernon is unavailable
 for comment  </p>
</div>
	<div class="site-nav span2" align="center">
          <ul class="nav nav-list" id="site-links">
            <li class="nav-header"> 
              Site
            </li>
            <li><a href="http://theanalyst.github.io"><i class="icon-home" style="color: #1f334b">
                </i>Home</a></li>
            <li><a href="http://theanalyst.github.io/archives.html"><i class="icon-list" style="color: #1f334b">
                </i>Archives</a></li>
	    <li><a href="http://theanalyst.github.io/tags.html"><i class="icon-tags" style="color: #1f334b">
                </i>Tags</a></li>
	    
	    <li> <a href="http://theanalyst.github.io/feeds/all.rss.xml" rel="alternate">
                <i class="icon-rss" style="color: #1f334b"></i>
                RSS Feed</a></li>
            <li><a href="http://theanalyst.github.io/" rel="alternate">
                <i class="icon-rss-sign" style="color: #1f334b"></i>
                Atom Feed</a></li>
	  </ul>

        </div>

      </div> <!--end of fluid row-->
    </div> <!--end of blog-footer-->
    <hr />
    <p align="center"><a href="http://theanalyst.github.io">Often Bearing Metaphoric Tense</a>
      &copy; Abhishek L
    Powered by <a href="https://github.com/getpelican/pelican">Pelican</a> and
        <a href="https://twitter.github.com/bootstrap">Twitter Bootstrap</a>. 
        Icons by <a href="http://fortawesome.github.com/Font-Awesome">Font Awesome</a> and 
        <a href="http://gregoryloucas.github.com/Font-Awesome-More">Font Awesome More</a></p>

  </div> <!--end of well -->
</div> <!--end of container -->

<!--/footer-->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>



</body>
</html>