<!DOCTYPE html>
<html lang="">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        
        <meta name="twitter:card" content="summary_large_image"/>
        <meta name="twitter:image" content="/images/kindle.jpg"/>
    



<meta name="twitter:title" content="2014: the year in books, using Goodreads, pandas &amp; Hy"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@abhishekl"/>



  	<meta property="og:title" content="2014: the year in books, using Goodreads, pandas &amp; Hy &middot; Often Bearing Metaphoric Tense" />
  	<meta property="og:site_name" content="Often Bearing Metaphoric Tense" />
  	<meta property="og:url" content="http://www.includeio.stream/tech/goodreads/" />

    
       <meta property="og:image" content="/images/kindle.jpg"/>
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2014-12-21T00:00:00Z" />

    
    <meta property="article:tag" content="Hy" />
    
    <meta property="article:tag" content="Goodreads" />
    
    <meta property="article:tag" content="Pandas" />
    
    <meta property="article:tag" content="Kindle" />
    
    

    <title>2014: the year in books, using Goodreads, pandas &amp; Hy &middot; Often Bearing Metaphoric Tense</title>

    
    <meta name="description" content="Note: The content has been updated to reflect the new kwargs style in Hy, as such the snippets only work with the current Hy master
As 2014 is coming to a close" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://www.includeio.stream/images/favicon.ico">
	  <link rel="apple-touch-icon" href="http://www.includeio.stream/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="http://www.includeio.stream/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="http://www.includeio.stream/css/nav.css" />

    

    

    
      
          <link href="http://www.includeio.stream/index.xml" rel="alternate" type="application/rss+xml" title="Often Bearing Metaphoric Tense" />
      
      
    
    <meta name="generator" content="Hugo 0.31.1" />

    <link rel="canonical" href="http://www.includeio.stream/tech/goodreads/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": 
    },
    "author": {
        "@type": "Person",
        "name": ,
        
        "url": ,
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": 2014: the year in books, using Goodreads, pandas &amp; Hy,
    "name": 2014: the year in books, using Goodreads, pandas &amp; Hy,
    "wordCount": 732,
    "timeRequired": "PT4M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": en
    },
    "url": http://www.includeio.stream/tech/goodreads/,
    "datePublished": 2014-12-21T00:00Z,
    "dateModified": 2014-12-21T00:00Z,
    
    "image": {
        "@type": "ImageObject",
        "url": http://www.includeio.stream/images/kindle.jpg,
        "width": 3000,
        "height": 1445
    },
    
    "keywords": Hy, Goodreads, Pandas, Kindle,
    "description": ,
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": http://www.includeio.stream/tech/goodreads/
    }
}
    </script>
    


    

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/theanalyst">Github</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="#ZgotmplZ">Blog</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="http://www.includeio.stream/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



  
  <header class="main-header post-head" style="background-image: url(/images/kindle.jpg)">
  
  <nav class="main-nav overlay clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post Tech">

    <header class="post-header">
        <h1 class="post-title">2014: the year in books, using Goodreads, pandas &amp; Hy</h1>
        <small></small>

        <section class="post-meta">
        
         
          <span class="post-tag small"><a href="http://www.includeio.stream//tags/hy/">#Hy</a></span>
         
          <span class="post-tag small"><a href="http://www.includeio.stream//tags/goodreads/">#Goodreads</a></span>
         
          <span class="post-tag small"><a href="http://www.includeio.stream//tags/pandas/">#Pandas</a></span>
         
          <span class="post-tag small"><a href="http://www.includeio.stream//tags/kindle/">#Kindle</a></span>
         
        </section>
    </header>

    <section class="post-content">
      <p><code>Note: The content has been updated to reflect the new kwargs style
in Hy, as such the snippets only work with the current Hy master</code></p>

<p>As 2014 is coming to a close, I thought it would be a nice time to
review the year as far as reading was concerned. Since I track the
books I read using Goodreads, I felt it would be an interesting
experiment to see some numbers from Goodreads. Though Goodreads
provides an api, it doesn&rsquo;t seem to be directly useful to get some
numbers from a user account (I could be wrong here). Fortunately, an
export to csv option is provieded in the account which helps in our
favor.</p>

<p>For any kind of data analysis in python, <a href="http://pandas.pydata.org">pandas</a> is a brilliant
library. Also it does most of the heavy lifting as far as processing
csv files are concerned. Since <a href="http://hylang.org">Hy</a> works wherever python works, I
thought it would be an interesting experiment to use Hy to parse the
data.</p>

<p>To start with reading csv is a simple call to pandas&rsquo; <code>read_csv</code>
function. This can be done with only the interesting fields.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-hylang" data-lang="hylang">(<span style="color:#66d9ef">import </span>pandas
        [numpy <span style="color:#e6db74">:as</span> np]
        [matplotlib.pyplot <span style="color:#e6db74">:as</span> plt]
        [seaborn <span style="color:#e6db74">:as</span> sns])

(<span style="color:#66d9ef">defn </span>parse-goodreads-csv [filepath]
  (<span style="color:#66d9ef">let </span>[[required-fields [<span style="color:#e6db74">&#34;Title&#34;</span> <span style="color:#e6db74">&#34;Date Read&#34;</span> <span style="color:#e6db74">&#34;Bookshelves&#34;</span>
                          <span style="color:#e6db74">&#34;Number of Pages&#34;</span> <span style="color:#e6db74">&#34;Original Publication Year&#34;</span>]]
        (pandas.read_csv filepath <span style="color:#e6db74">:usecols</span> required-fields
			             <span style="color:#e6db74">:index-col</span> <span style="color:#e6db74">&#34;Date Read&#34;</span> <span style="color:#e6db74">:parse-dates</span> true)))</code></pre></div>

<p>Now taking out only the column&rsquo;s we&rsquo;re interested in &amp; filtering out
the data from only a particular year can be done by</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-hylang" data-lang="hylang">(<span style="color:#66d9ef">defn </span>books-in-year [dataframe year]
  (<span style="color:#66d9ef">let </span>[[day1 (<span style="color:#66d9ef">fn </span>[y] (+ (str y) <span style="color:#e6db74">&#34;-01-01&#34;</span>))]]
    (slice (. dataframe ix) (day1 year) (day1 (inc year)))))</code></pre></div>

<p><code>ix</code> returns the index of dataframe, since we&rsquo;ll be indexing by date
read, this allows us to select the required range, by simply selecting
a date range from the beginning of the year to the next year.</p>

<p>Since it would be interesting to see the count of books as well as the
pages on a monthly basis, we should filter the data on a monthly
basis. Pandas offers a <a href="http://pandas.pydata.org/pandas-docs/stable/groupby.html"><code>groupby</code></a> &amp; <code>aggregate</code> much similiar to
SQL like queries. So all we have to do is to group pages by month
here.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-hylang" data-lang="hylang">(<span style="color:#66d9ef">defn </span>aggregate-by-month [dataframe params]
  <span style="color:#e6db74">&#34;Group a particular key by month&#34;</span>
  (<span style="color:#66d9ef">-&gt; </span>(.groupby dataframe (. dataframe index month))
      (.aggregate params)))</code></pre></div>

<p>The above function assumes that the dataframe object is already
indexed by a timeframe data, (Date Read in our case), then a simple
groupby month is performed and supplied to <code>aggregate</code> which does a
cumulative operation on the grouped data according the supplied
functions. The threading operator <code>-&gt;</code> makes the result of the first
call as the first argument of the function. Now we have enough to get
some stats for the year.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-hylang" data-lang="hylang">(<span style="color:#66d9ef">defn </span>process [filepath]
  (<span style="color:#66d9ef">let </span>[[books-in-2014
          (<span style="color:#66d9ef">-&gt; </span>(parse-goodreads-csv filepath)
              (books-in-year <span style="color:#ae81ff">2014</span>))]
        [pages-per-month (<span style="color:#66d9ef">-&gt; </span>(. books-in-2014 [[<span style="color:#e6db74">&#34;Number of Pages&#34;</span>]])
                         (aggregate-by-month [<span style="color:#e6db74">&#34;sum&#34;</span> <span style="color:#e6db74">&#34;count&#34;</span> np.mean]))]]
  (<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;Pages read in 2014 &#34;</span>
         ((. books-in-2014 [<span style="color:#e6db74">&#34;Number of Pages&#34;</span>] sum)))
  (<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;Pages read in kindle&#34;</span>
         ((. books-in-2014 [(= books-in-2014.Bookshelves <span style="color:#e6db74">&#34;kindle&#34;</span>)]
             [<span style="color:#e6db74">&#34;Number of Pages&#34;</span>] sum)))
  (<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;Monthly Stats&#34;</span>)
  (<span style="color:#66d9ef">print</span> pages-per-month)</code></pre></div>

<p>First, the <code>parse-csv</code> function is given only the interesting columns,
also indexing is done via date read, we get <code>pages-per-month</code> via the
aggregate &amp; groupby function shown earlier. Counting the pages read in
Kindle was done by summing columns containing the Book shelves
(alternatively if you had marked the editions correctly another field
suggest the Kindle edition..).</p>

<pre><code>Pages read in 2014  6659.0
Pages read in kindle 4489.0
Monthly Stats
Number of Pages
            sum  count        mean
 1              1061      3  353.666667
 2               136      2   68.000000
 6               373      1  373.000000
 8               484      2  242.000000
 9              1445      8  180.625000
 10             2126     17  125.058824
 11              262      1  262.000000
 12              772      6  128.666667
</code></pre>

<p>Finally this is the plot of pages</p>

<p><img src="http://www.includeio.stream/images/pages-per-month.png" alt="pages_per_month" /></p>

<p>Overall 2014 was a good year as far as reading was concerned, read a
lot of classics which had been on my backlog for quite sometime. Also
read <em>The Guide</em>, which was pending for quite some time. Next year I
should follow a more consistent schedule :), there were months with no
reading at all and a few with too much (the peak in october was
probably due to the combined holidays here, at that time) The raw data
and output (as well as the program) are available in my <a href="http://github.com/theanalyst/cuddlebear">github</a>
repo.</p>

<p>PS For those of you interested in knowing what I&rsquo;ve been reading
checkout <a href="https://www.goodreads.com/review/list/14029645-abhishek?read_at=2014&amp;view=covers">my goodreads 2014 list</a>. Do suggest anything worth
reading in the comments. Cya!</p>

    </section>


  <footer class="post-footer">


    




    
<section class="share">
  <h4>Share this Tech</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=2014%3a%20the%20year%20in%20books%2c%20using%20Goodreads%2c%20pandas%20%26%20Hy&nbsp;-&nbsp;Often%20Bearing%20Metaphoric%20Tense&amp;url=http%3a%2f%2fwww.includeio.stream%2ftech%2fgoodreads%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fwww.includeio.stream%2ftech%2fgoodreads%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=http%3a%2f%2fwww.includeio.stream%2ftech%2fgoodreads%2f&amp;description=2014%3a%20the%20year%20in%20books%2c%20using%20Goodreads%2c%20pandas%20%26%20Hy"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=http%3a%2f%2fwww.includeio.stream%2ftech%2fgoodreads%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "http:\/\/www.includeio.stream\/tech\/goodreads\/";  
this.page.identifier = "http:\/\/www.includeio.stream\/tech\/goodreads\/"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://hyperbolicmonologues.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>








  </footer>
</article>

</main>


  <aside class="read-next">
  
      <a class="read-next-story" style="no-cover" href="http://www.includeio.stream/tech/travis-builds/">
          <section class="post">
              <h2>Faster python builds in Travis with container based infra</h2>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="no-cover" href="http://www.includeio.stream/tech/learn/">
          <section class="post">
              <h2>The Silent Observer&#39;s Metamorphosis</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Often Bearing Metaphoric Tense</a> All rights reserved 2012-15</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="http://www.includeio.stream/js/jquery.js"></script>
    <script type="text/javascript" src="http://www.includeio.stream/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://www.includeio.stream/js/index.js"></script>
    
</body>
</html>

